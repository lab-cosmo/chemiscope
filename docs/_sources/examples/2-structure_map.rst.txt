
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples/2-structure_map.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_examples_2-structure_map.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_2-structure_map.py:


Structure-property maps
=======================

This example demonstrates the visualization of structures (or environments) using
data-driven descriptors of their geometry to cluster together similar motifs. Here, the
geometric descriptors have been computed by PCA starting from SOAP representations but
are provided as text files to avoid external dependencies for the example.

The same parameters demonstrated on this example can be used with
:py:func:`chemiscope.show` to visualize an interactive widget in a Jupyter notebook.

.. GENERATED FROM PYTHON SOURCE LINES 16-23

.. code-block:: Python


    import ase.io
    import numpy as np

    import chemiscope









.. GENERATED FROM PYTHON SOURCE LINES 24-25

Load structures:

.. GENERATED FROM PYTHON SOURCE LINES 25-28

.. code-block:: Python


    structures = ase.io.read("data/trajectory.xyz", ":")








.. GENERATED FROM PYTHON SOURCE LINES 29-33

Load the SOAP-PCA descriptors. To obtain them yourself, check the :ref:`examples
<explore-advanced-example>` of feature calculation and dimentionality reduction.
Chemiscope also provides :py:func:`chemiscope.explore` function to automatically
create the features using machine learning models.

.. GENERATED FROM PYTHON SOURCE LINES 34-38

.. code-block:: Python


    pca_atom = np.loadtxt("data/trajectory-pca_atom.dat")
    pca_structure = np.loadtxt("data/trajectory-pca_structure.dat")








.. GENERATED FROM PYTHON SOURCE LINES 39-46

When both environments and structure properties are present, a toggle allows you to
switch between both modes.

.. note::

    if there are properties stored in the ASE structures, you can extract them with
    :py:func:`chemiscope.extract_properties`

.. GENERATED FROM PYTHON SOURCE LINES 47-62

.. code-block:: Python


    properties = {
        # concise definition of a property, with just an array and the type
        # inferred by the size
        "structure PCA": pca_structure,
        "atom PCA": pca_atom,
        # an example of the verbose definition
        "energy": {
            "target": "structure",
            "values": [s.info["dftb_energy_eV"] for s in structures],
            "units": "eV",
            "description": "potential energy, computed with DFTB+",
        },
    }








.. GENERATED FROM PYTHON SOURCE LINES 63-64

Environment descriptors have only been computed for C and O atoms.

.. GENERATED FROM PYTHON SOURCE LINES 65-73

.. code-block:: Python

    environments = []
    cutoff = 4.0
    for structure_i, structure in enumerate(structures):
        for atom_i, atom in enumerate(structure.numbers):
            if atom == 6 or atom == 8:
                environments.append((structure_i, atom_i, cutoff))









.. GENERATED FROM PYTHON SOURCE LINES 74-76

Create a visualization and save it as a file that can be viewed at
`<chemiscope.org>`_:

.. GENERATED FROM PYTHON SOURCE LINES 77-105

.. code-block:: Python


    chemiscope.write_input(
        "trajectory-pca.json.gz",
        # dataset metadata can also be included to provide a self-contained description
        # of the data, authors, and references
        metadata={
            "name": "Allyl alcohol PCA map",
            "description": (
                "This dataset contains a PCA map of the C and O environments "
                "from a few structures out of a MD simulation of allyl alcohol, C3H5OH."
            ),
            "authors": ["The chemiscope developers"],
            "references": [
                (
                    "G. Fraux, R. Cersonsky, and M. Ceriotti, "
                    '"Chemiscope: interactive structure-property explorer for materials '
                    'and molecules," JOSS 5(51), 2117 (2020).'
                )
            ],
        },
        structures=structures,
        properties=properties,
        environments=environments,
        settings={  # these are reasonable settings for trajectory visualization
            "structure": [{"keepOrientation": True, "playbackDelay": 100}]
        },
    )








.. GENERATED FROM PYTHON SOURCE LINES 106-108

The file can also be viewed in a notebook. Use `chemiscope.show` above to bypass the
creation of a JSON file and directly create a viewer.

.. GENERATED FROM PYTHON SOURCE LINES 109-111

.. code-block:: Python


    chemiscope.show_input("trajectory-pca.json.gz")


.. chemiscope:: _datasets/fig_2-structure_map_003.json.gz
            :mode: default
            :warning_timeout: 2000
        


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">

    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.023 seconds)


.. _sphx_glr_download_examples_2-structure_map.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 2-structure_map.ipynb <2-structure_map.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 2-structure_map.py <2-structure_map.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 2-structure_map.zip <2-structure_map.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
